<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DivWin: /media/FileStore/My Documents/C++ Code/DivWinLibrary/src/Camera/WTcPainter.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DivWin&#160;<span id="projectnumber">1.0v</span></div>
   <div id="projectbrief">Games Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('_w_tc_painter_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>/media/FileStore/My Documents/C++ Code/DivWinLibrary/src/Camera/WTcPainter.cpp</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;../WTDivWin.h&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <a class="code" href="classc_painter.html">cPainter</a> *cPainter::mpInstance=0;
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 
<a name="l00007"></a><a class="code" href="classc_painter.html#a0ad633317beac0e412434548ccbe8995">00007</a> <a class="code" href="classc_painter.html">cPainter</a> *<a class="code" href="classc_painter.html#a0ad633317beac0e412434548ccbe8995" title="This will return the current instance of the cPainter algorithm, if there is no current instance a ne...">cPainter::Instance</a>()
<a name="l00008"></a>00008 {
<a name="l00009"></a>00009  printf(<span class="stringliteral">&quot;Using cPainter\n&quot;</span>);
<a name="l00010"></a>00010  <span class="keywordflow">if</span>(!mpInstance) { mpInstance=<span class="keyword">new</span> <a class="code" href="classc_painter.html">cPainter</a>(); mpInstance-&gt;<a class="code" href="classc_painter.html#a0f2252892148f0e76a9c95cf6258de85" title="This will resize the array of cRenderPointer to change the number of cRenderObjects that can be held...">Resize</a>(WT_PAINTER_STARTING_SIZE);}
<a name="l00011"></a>00011  <span class="keywordflow">return</span> mpInstance;
<a name="l00012"></a>00012 }
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 cPainter::cPainter()<span class="comment">//uint32 liSize)</span>
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016 
<a name="l00017"></a>00017  mpList=0;
<a name="l00018"></a>00018  mpBucket=0;
<a name="l00019"></a>00019  miSize=0;
<a name="l00020"></a>00020 <span class="comment">// miAllocated=0;</span>
<a name="l00021"></a>00021  miPos=0;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023   glEnableClientState(GL_VERTEX_ARRAY);
<a name="l00024"></a>00024   glEnableClientState(GL_TEXTURE_COORD_ARRAY);
<a name="l00025"></a>00025   glEnableClientState(GL_NORMAL_ARRAY);
<a name="l00026"></a>00026 }
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="classc_painter.html#ac5f4532029629872f3a7285f426fd14b">00028</a> <a class="code" href="classc_painter.html#ac5f4532029629872f3a7285f426fd14b">cPainter::~cPainter</a>()
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030 <span class="keywordflow">if</span>(mpList) {<span class="keyword">delete</span> []mpList;mpList=0;}
<a name="l00031"></a>00031 <span class="keywordflow">if</span>(mpBucket) {<span class="keyword">delete</span> []mpBucket; mpBucket=0;}
<a name="l00032"></a>00032 }
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="classc_painter.html#a0f2252892148f0e76a9c95cf6258de85">00034</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#a0f2252892148f0e76a9c95cf6258de85" title="This will resize the array of cRenderPointer to change the number of cRenderObjects that can be held...">cPainter::Resize</a>(uint32 liSize)
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036 <a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a> **lpTemp;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038   lpTemp=<span class="keyword">new</span> <a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a>*[liSize];
<a name="l00039"></a>00039   memcpy(lpTemp,mpList,<span class="keyword">sizeof</span>(<a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a>*)*miSize);
<a name="l00040"></a>00040   <span class="keyword">delete</span> []mpList;
<a name="l00041"></a>00041   mpList=lpTemp;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043   lpTemp=<span class="keyword">new</span> <a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a>*[liSize];
<a name="l00044"></a>00044   memcpy(lpTemp,mpBucket,<span class="keyword">sizeof</span>(<a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a>*)*miSize);
<a name="l00045"></a>00045   <span class="keyword">delete</span> []mpBucket;
<a name="l00046"></a>00046   mpBucket=lpTemp;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048   miSize=liSize;
<a name="l00049"></a>00049  
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="classc_painter.html#a77807cb6f4b05d7425a162a2d69dfd2e">00052</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#a77807cb6f4b05d7425a162a2d69dfd2e">cPainter::Add</a>(<a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a> *lfData)
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054  
<a name="l00055"></a>00055 <span class="keywordflow">if</span>(miPos&gt;=miSize) {<a class="code" href="classc_painter.html#a0f2252892148f0e76a9c95cf6258de85" title="This will resize the array of cRenderPointer to change the number of cRenderObjects that can be held...">Resize</a>(miSize*2);}
<a name="l00056"></a>00056  mpList[miPos]=lfData;
<a name="l00057"></a>00057  ++miPos;
<a name="l00058"></a>00058 <span class="comment">//return &amp;mpList[miPos-1];</span>
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="classc_painter.html#a65b3e6e9472009ef951261d1641f3773">00062</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#a65b3e6e9472009ef951261d1641f3773" title="This will sort the array mpList based on object distance from the camera.">cPainter::SortByDistance</a>()
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064 
<a name="l00065"></a>00065  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> liPass=0;
<a name="l00066"></a>00066  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> liFindPos=0;
<a name="l00067"></a>00067  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> liSum=0,liOld=0;
<a name="l00068"></a>00068  <a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a> **lpSwitch=0;
<a name="l00069"></a>00069  uint32 lpStarts[0x100];
<a name="l00070"></a>00070 
<a name="l00071"></a>00071  memset(lpStarts,0,<span class="keyword">sizeof</span>(uint32)*0x100);
<a name="l00072"></a>00072  
<a name="l00073"></a>00073  <span class="keywordflow">for</span>(liPass=0;liPass&lt;miPos;++liPass)
<a name="l00074"></a>00074  {
<a name="l00075"></a>00075   
<a name="l00076"></a>00076   <span class="keywordtype">float</span> lfX,lfY,lfZ;
<a name="l00077"></a>00077   
<a name="l00078"></a>00078   
<a name="l00079"></a>00079   lfX=mpList[liPass]-&gt;<a class="code" href="classc_render_pointer.html#a3a931cfd60605a842ebf9d1b591adba8">mpObject</a>-&gt;<a class="code" href="classv_render_object.html#a7ac4333806eaa793c4ce83e25764ad3b" title="Matrix which Stores the final global position matrix of the object from the last frame. This is used to make collisions consistent and for finding object Global Positions. Note the Camera MAtrix will be included in this.">mmCache</a>.<a class="code" href="classc_matrix4.html#a8697973a28e45b0866cce4cdba2e216d" title="This will return a pointer to this objects matrix data.">Matrix</a>()[12];
<a name="l00080"></a>00080   lfY=mpList[liPass]-&gt;<a class="code" href="classc_render_pointer.html#a3a931cfd60605a842ebf9d1b591adba8">mpObject</a>-&gt;<a class="code" href="classv_render_object.html#a7ac4333806eaa793c4ce83e25764ad3b" title="Matrix which Stores the final global position matrix of the object from the last frame. This is used to make collisions consistent and for finding object Global Positions. Note the Camera MAtrix will be included in this.">mmCache</a>.<a class="code" href="classc_matrix4.html#a8697973a28e45b0866cce4cdba2e216d" title="This will return a pointer to this objects matrix data.">Matrix</a>()[13];
<a name="l00081"></a>00081   lfZ=mpList[liPass]-&gt;<a class="code" href="classc_render_pointer.html#a3a931cfd60605a842ebf9d1b591adba8">mpObject</a>-&gt;<a class="code" href="classv_render_object.html#a7ac4333806eaa793c4ce83e25764ad3b" title="Matrix which Stores the final global position matrix of the object from the last frame. This is used to make collisions consistent and for finding object Global Positions. Note the Camera MAtrix will be included in this.">mmCache</a>.<a class="code" href="classc_matrix4.html#a8697973a28e45b0866cce4cdba2e216d" title="This will return a pointer to this objects matrix data.">Matrix</a>()[14];
<a name="l00082"></a>00082  
<a name="l00083"></a>00083   mpList[liPass]-&gt;<a class="code" href="classc_render_pointer.html#a0a87e7addf0caeb10eb7aee109ac958a">miDist</a>=<span class="keyword">static_cast&lt;</span>uint32<span class="keyword">&gt;</span>(lfX*lfX+lfY*lfY+lfZ*lfZ);
<a name="l00084"></a>00084  }
<a name="l00085"></a>00085  
<a name="l00086"></a>00086 <span class="keywordflow">for</span>(liPass=0;liPass&lt;25;liPass+=8)
<a name="l00087"></a>00087 {
<a name="l00088"></a>00088   <span class="comment">//Reset the bucket sizes</span>
<a name="l00089"></a>00089   memset(lpStarts,0,0x100*<span class="keyword">sizeof</span>(uint32));
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 
<a name="l00092"></a>00092  <span class="comment">//Find the size of each bucket;</span>
<a name="l00093"></a>00093   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;miPos;++liFindPos)
<a name="l00094"></a>00094   {
<a name="l00095"></a>00095           <span class="comment">//Apparently uninitialised value here! Believes that miDist is uninitialised, as comes from mmCache.Matrix()...</span>
<a name="l00096"></a>00096         ++lpStarts[(mpList[liFindPos]-&gt;<a class="code" href="classc_render_pointer.html#a0a87e7addf0caeb10eb7aee109ac958a">miDist</a>&gt;&gt;liPass)&amp;0xFF];
<a name="l00097"></a>00097     
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   <span class="comment">//Convert bucket sizes to bucket starts.</span>
<a name="l00101"></a>00101   liSum=0;
<a name="l00102"></a>00102   liOld=0;
<a name="l00103"></a>00103   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;0x100;++liFindPos)
<a name="l00104"></a>00104   {
<a name="l00105"></a>00105    liSum+=lpStarts[liFindPos];
<a name="l00106"></a>00106    lpStarts[liFindPos]=liOld;
<a name="l00107"></a>00107    liOld=liSum;
<a name="l00108"></a>00108   }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   <span class="comment">//Fill the Buckets.</span>
<a name="l00111"></a>00111   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;miPos;++liFindPos)
<a name="l00112"></a>00112   {
<a name="l00113"></a>00113     <span class="comment">//Believes something is not initialised. lpStarts?</span>
<a name="l00114"></a>00114         mpBucket[lpStarts[(mpList[liFindPos]-&gt;<a class="code" href="classc_render_pointer.html#a0a87e7addf0caeb10eb7aee109ac958a">miDist</a>&gt;&gt;liPass)&amp;0xff]++]=mpList[liFindPos];
<a name="l00115"></a>00115   }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117   lpSwitch=mpBucket;
<a name="l00118"></a>00118   mpBucket=mpList;
<a name="l00119"></a>00119   mpList=lpSwitch;
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="classc_painter.html#aa8cf6053e8a310fc843e5e9cd7c95173">00124</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#aa8cf6053e8a310fc843e5e9cd7c95173" title="This will sort the array mpList based on object shader program.">cPainter::SortByShader</a>()
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> liPass;
<a name="l00127"></a>00127  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> liFindPos;
<a name="l00128"></a>00128  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> liSum,liOld;
<a name="l00129"></a>00129  <a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a> **lpSwitch;
<a name="l00130"></a>00130  psize lpStarts[0x100];
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="keywordflow">for</span>(liPass=0;liPass&lt;pbits;liPass+=8)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134   <span class="comment">//Reset the bucket sizes</span>
<a name="l00135"></a>00135   memset(lpStarts,0,1024);
<a name="l00136"></a>00136  <span class="comment">//Find the size of each bucket;</span>
<a name="l00137"></a>00137   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;miPos;++liFindPos) {++lpStarts[(<span class="keyword">reinterpret_cast&lt;</span>psize<span class="keyword">&gt;</span>(mpList[liFindPos]-&gt;<a class="code" href="classc_render_pointer.html#a52d59a73dafe36627f8e91fd7894ac4c">mpShader</a>)&gt;&gt;liPass)&amp;0xff];}
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <span class="comment">//Convert bucket sizes to bucket starts.</span>
<a name="l00140"></a>00140   liSum=liOld=0;
<a name="l00141"></a>00141   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;0x100;++liFindPos)
<a name="l00142"></a>00142   {
<a name="l00143"></a>00143    liSum+=lpStarts[liFindPos];
<a name="l00144"></a>00144    lpStarts[liFindPos]=liOld;
<a name="l00145"></a>00145    liOld=liSum;
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="comment">//Fill the Buckets.</span>
<a name="l00149"></a>00149   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;miPos;++liFindPos){mpBucket[lpStarts[(<span class="keyword">reinterpret_cast&lt;</span>psize<span class="keyword">&gt;</span>(mpList[liFindPos]-&gt;<a class="code" href="classc_render_pointer.html#a52d59a73dafe36627f8e91fd7894ac4c">mpShader</a>)&gt;&gt;liPass)&amp;0xff]++]=mpList[liFindPos];}
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   lpSwitch=mpBucket;
<a name="l00152"></a>00152   mpBucket=mpList;
<a name="l00153"></a>00153   mpList=lpSwitch;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="classc_painter.html#a06f0d0777d5578793ea5cb07aa8b10cc">00157</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#a06f0d0777d5578793ea5cb07aa8b10cc" title="This will sort the array mpList based on the texture that each object uses.">cPainter::SortByTexture</a>()
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> liPass;
<a name="l00160"></a>00160  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> liFindPos;
<a name="l00161"></a>00161  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> liSum,liOld;
<a name="l00162"></a>00162  <a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a> **lpSwitch;
<a name="l00163"></a>00163  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> lpStarts[0x100];
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="keywordflow">for</span>(liPass=0;liPass&lt;25;liPass+=8)
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167   <span class="comment">//Reset the bucket sizes</span>
<a name="l00168"></a>00168   memset(lpStarts,0,1024);
<a name="l00169"></a>00169  <span class="comment">//Find the size of each bucket;</span>
<a name="l00170"></a>00170   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;miPos;++liFindPos) {++lpStarts[(mpList[liFindPos]-&gt;<a class="code" href="classc_render_pointer.html#a70c8e938776212e3d8a56c2ab5e87489">mpTexture</a>&gt;&gt;liPass)&amp;0xff];}
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="comment">//Convert bucket sizes to bucket starts.</span>
<a name="l00173"></a>00173   liSum=liOld=0;
<a name="l00174"></a>00174   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;0x100;++liFindPos)
<a name="l00175"></a>00175   {
<a name="l00176"></a>00176    liSum+=lpStarts[liFindPos];
<a name="l00177"></a>00177    lpStarts[liFindPos]=liOld;
<a name="l00178"></a>00178    liOld=liSum;
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="comment">//Fill the Buckets.</span>
<a name="l00182"></a>00182   <span class="keywordflow">for</span>(liFindPos=0;liFindPos&lt;miPos;++liFindPos){mpBucket[lpStarts[(mpList[liFindPos]-&gt;<a class="code" href="classc_render_pointer.html#a70c8e938776212e3d8a56c2ab5e87489">mpTexture</a>&gt;&gt;liPass)&amp;0xff]++]=mpList[liFindPos];}
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   lpSwitch=mpBucket;
<a name="l00185"></a>00185   mpBucket=mpList;
<a name="l00186"></a>00186   mpList=lpSwitch;
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="classc_painter.html#aa94ad2ace4bb757245e20aa6f3983ab4">00191</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#aa94ad2ace4bb757245e20aa6f3983ab4" title="This will sort the array mpList based on the alpha value that each object uses.">cPainter::SortByAlpha</a>()
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> liStart,liEnd,liPos;
<a name="l00194"></a>00194 <a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a> **lpSwitch;
<a name="l00195"></a>00195 liEnd=miPos-1;
<a name="l00196"></a>00196 liPos=liStart=0;
<a name="l00197"></a>00197 <span class="keywordflow">for</span>(liPos=0;liPos&lt;miPos;++liPos)
<a name="l00198"></a>00198 {<span class="keywordflow">if</span>(mpList[liPos]-&gt;mbAlpha){mpBucket[liEnd--]=mpList[liPos];}
<a name="l00199"></a>00199  <span class="keywordflow">else</span>{mpBucket[liStart++]=mpList[liPos];}
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 lpSwitch=mpBucket;
<a name="l00202"></a>00202 mpBucket=mpList;
<a name="l00203"></a>00203 mpList=lpSwitch;
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="classc_painter.html#a1d4ecd48a9b508962a340f95c65bd044">00206</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#a1d4ecd48a9b508962a340f95c65bd044">cPainter::ShaderState</a>(<a class="code" href="classv_shader_program.html" title="This is a virtual class for a Shader Program. A shader program is a series of cShader() objects to be...">vShaderProgram</a> *mpCurrent,<a class="code" href="classv_shader_program.html" title="This is a virtual class for a Shader Program. A shader program is a series of cShader() objects to be...">vShaderProgram</a> *mpLast)
<a name="l00207"></a>00207 {
<a name="l00208"></a>00208   <span class="keywordflow">if</span>(mpCurrent)
<a name="l00209"></a>00209   {
<a name="l00210"></a>00210    <span class="keywordflow">if</span>(mpCurrent!=mpLast)
<a name="l00211"></a>00211    {
<a name="l00212"></a>00212     mpCurrent-&gt;<a class="code" href="classv_shader_program.html#a9772ed9e4d99d064e6bf4cd59207c361" title="This will make the system Use this Shader Program, until another is set or a shader program is turned...">Use</a>();
<a name="l00213"></a>00213    }
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(mpLast) {_USE_FIXED_FUNCTION();}
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a><a class="code" href="classc_painter.html#ad88e9a81b90b044e0a93f26cf92efe98">00219</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#ad88e9a81b90b044e0a93f26cf92efe98">cPainter::TextureState</a>(uint32 mpCurrent,uint32 mpLast)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221   <span class="keywordflow">if</span>(mpCurrent)
<a name="l00222"></a>00222   {
<a name="l00223"></a>00223    <span class="keywordflow">if</span>(!mpLast) {glEnable(GL_TEXTURE_2D); glEnableClientState(GL_TEXTURE_COORD_ARRAY);}
<a name="l00224"></a>00224    <span class="keywordflow">if</span>(mpCurrent!=mpLast)
<a name="l00225"></a>00225    {
<a name="l00226"></a>00226       glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
<a name="l00227"></a>00227     <span class="comment">//glTexEnvf(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_DECAL);</span>
<a name="l00228"></a>00228     glBindTexture(GL_TEXTURE_2D,mpCurrent);
<a name="l00229"></a>00229    }
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(mpLast) {glDisableClientState(GL_TEXTURE_COORD_ARRAY); glDisable(GL_TEXTURE_2D);}
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="classc_painter.html#a38adbfdd43c6951d86592f539f2dc034">00234</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#a38adbfdd43c6951d86592f539f2dc034">cPainter::Render</a>()
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236 
<a name="l00237"></a>00237  uint32 liCount;
<a name="l00238"></a>00238  <a class="code" href="classc_painter.html#a65b3e6e9472009ef951261d1641f3773" title="This will sort the array mpList based on object distance from the camera.">SortByDistance</a>();
<a name="l00239"></a>00239 
<a name="l00240"></a>00240  <a class="code" href="classc_painter.html#aa8cf6053e8a310fc843e5e9cd7c95173" title="This will sort the array mpList based on object shader program.">SortByShader</a>();
<a name="l00241"></a>00241 
<a name="l00242"></a>00242  <a class="code" href="classc_painter.html#a06f0d0777d5578793ea5cb07aa8b10cc" title="This will sort the array mpList based on the texture that each object uses.">SortByTexture</a>();
<a name="l00243"></a>00243 
<a name="l00244"></a>00244  <a class="code" href="classc_painter.html#aa94ad2ace4bb757245e20aa6f3983ab4" title="This will sort the array mpList based on the alpha value that each object uses.">SortByAlpha</a>();
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 printf(<span class="stringliteral">&quot;cPainter::RenderPainter\n&quot;</span>);
<a name="l00248"></a>00248 glEnableClientState(GL_VERTEX_ARRAY);
<a name="l00249"></a>00249 glEnableClientState(GL_NORMAL_ARRAY);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251  <span class="keywordflow">for</span>(liCount=0;liCount&lt;miPos;liCount++)
<a name="l00252"></a>00252  {
<a name="l00253"></a>00253          
<a name="l00254"></a>00254   <span class="keywordflow">if</span>(mpList[liCount]-&gt;mbReRender)
<a name="l00255"></a>00255   {
<a name="l00256"></a>00256           
<a name="l00257"></a>00257   <span class="keywordflow">if</span>(liCount) 
<a name="l00258"></a>00258   {
<a name="l00259"></a>00259     <a class="code" href="classc_painter.html#ad88e9a81b90b044e0a93f26cf92efe98">TextureState</a>(mpList[liCount]-&gt;mpTexture,mpList[liCount-1]-&gt;mpTexture);
<a name="l00260"></a>00260     <a class="code" href="classc_painter.html#a1d4ecd48a9b508962a340f95c65bd044">ShaderState</a>(mpList[liCount]-&gt;mpShader,mpList[liCount-1]-&gt;mpShader);
<a name="l00261"></a>00261   }
<a name="l00262"></a>00262   <span class="keywordflow">else</span>
<a name="l00263"></a>00263   {
<a name="l00264"></a>00264     <a class="code" href="classc_painter.html#ad88e9a81b90b044e0a93f26cf92efe98">TextureState</a>(mpList[liCount]-&gt;mpTexture,0);
<a name="l00265"></a>00265     <a class="code" href="classc_painter.html#a1d4ecd48a9b508962a340f95c65bd044">ShaderState</a>(mpList[liCount]-&gt;mpShader,0);
<a name="l00266"></a>00266   }
<a name="l00267"></a>00267  
<a name="l00268"></a>00268   glLoadMatrixf(mpList[liCount]-&gt;mpObject-&gt;mmCache.Matrix());
<a name="l00269"></a>00269   mpList[liCount]-&gt;<a class="code" href="classc_render_pointer.html#a3a931cfd60605a842ebf9d1b591adba8">mpObject</a>-&gt;<a class="code" href="classc_render_object.html#ab2a666638043054e563b9f0a54faa6b7" title="virtual functions to allow polymorphism. see cCamera::RenderPainter();">RenderPainter</a>(mpList[liCount]-&gt;miLevel);
<a name="l00270"></a>00270   mpList[liCount]-&gt;<a class="code" href="classc_render_pointer.html#a7ef8dbb11d8bc69a9549db62a45679a7">mbReRender</a>=<span class="keyword">false</span>;
<a name="l00271"></a>00271   }
<a name="l00272"></a>00272  }
<a name="l00273"></a>00273 }
<a name="l00274"></a>00274 
<a name="l00275"></a><a class="code" href="classc_painter.html#adcf40f909775cd15c58ed34968ce8f3c">00275</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#adcf40f909775cd15c58ed34968ce8f3c">cPainter::Remove</a>(<a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a> *lfSlot)
<a name="l00276"></a>00276   {
<a name="l00277"></a>00277 uint32 liCount;
<a name="l00278"></a>00278   <span class="keywordflow">for</span>(liCount=0;liCount&lt;miPos;++liCount)
<a name="l00279"></a>00279   {
<a name="l00280"></a>00280         <span class="keywordflow">if</span>(mpList[liCount]==lfSlot)
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282                   <span class="keywordflow">if</span>(miPos-liCount) memmove(&amp;mpList[liCount],&amp;mpList[liCount+1],<span class="keyword">sizeof</span>(<a class="code" href="classc_render_pointer.html" title="This class is a temporary store for a cRenderObjects data. This is the complete render matrix and all...">cRenderPointer</a>**)*(miPos-liCount)-1);
<a name="l00283"></a>00283                   --miPos;
<a name="l00284"></a>00284                   <span class="keywordflow">return</span>;
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286   }
<a name="l00287"></a>00287     
<a name="l00288"></a>00288  }
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="classc_painter.html#a0dd641a9ab21cade6d1c339fe498dbb5">00290</a> <span class="keywordtype">void</span> <a class="code" href="classc_painter.html#a0dd641a9ab21cade6d1c339fe498dbb5">cPainter::Reset</a>()
<a name="l00291"></a>00291 {
<a name="l00292"></a>00292   glDisableClientState(GL_TEXTURE_COORD_ARRAY); glDisable(GL_TEXTURE_2D);
<a name="l00293"></a>00293   
<a name="l00294"></a>00294 };
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>WTcPainter.cpp</b>      </li>
      <li class="footer">Generated on Sun Sep 11 2011 13:58:39 for DivWin by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
